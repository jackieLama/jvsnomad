plugins {
    id 'fabric-loom' version '1.11-SNAPSHOT' apply(false)
    id 'net.neoforged.moddev.legacyforge' version '2.0.106' apply(false)
    id "me.modmuss50.mod-publish-plugin" version "1.1.0" apply(false)
}

def patchNoteProvider = providers.provider {
    def file = rootProject.layout.projectDirectory.file("patch_notes.md").asFile
    if (!file.exists()) {
        throw new GradleException("MISSING PATCH NOTES !!")
    }
    file.text
}

configure([project(":fabric"), project(":forge")]) {
    apply plugin: 'me.modmuss50.mod-publish-plugin'

    publishMods {
        changelog = patchNoteProvider
        type = STABLE

        curseforge {
            projectId = ""
            accessToken = providers.environmentVariable("CURSEFORGE_API_KEY")
            minecraftVersions.add(project.property("minecraft_version"))

            changelogType = "markdown"

            /* shared dependencies found on curseforge
            requires("slug")
            optional("slug")
            incompatible("slug")
            embeds("slug")
             */
        }

        modrinth {
            projectId = ""
            accessToken = providers.environmentVariable("MODRINTH_API_KEY")
            minecraftVersions.add(project.property("minecraft_version"))

            /* shared dependencies found on modrinth
            requires { // specify either id or slug, but not both at once
                id = ""
                slug = ""

                version = "" // optional
            } // or `requires("slug")` if you only need/want to specify the slug

            // all of these have the same format as above
            optional { }
            incompatible { }
            embeds { }
            */
        }
    }
}